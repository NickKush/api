Уведомления
===========
1. [**Событие уведомления**](#Событие-уведомления)
2. [**Типы уведомлений**](#Типы-уведомлений)
    - [`chatBan` Бан в чате](#Бан-в-чате)
    - [`chatBanAttempt` Отметка о нарушении в чате](#Отметка-о-нарушении-в-чате)
    - [`chatBanUndo` Отмена бана в чате](#Отмена-бана-в-чате)
    - [`chatChannelDonateLevel` Изменение донат уровня канала чата](#Изменение-донат-уровня-канала-чата)
    - [`chatThirdpartySendMessageError` Ошибка отправки сообщения в чат сервис](#Ошибка-отправки-сообщения-в-чат-сервис)
    - [`thirdpartyLogin` Логин через сторонние сервисы](#Логин-через-сторонние-сервисы)
    - [`thirdpartyRegister` Регистрация через сторонние сервисы](#Регистрация-через-сторонние-сервисы)


Событие уведомления
-------------------
Для уведомлений пользователя о всяческом используется событие вебсокетов [чата](chat.md#Протокол-взаимодействия) `/notifier/message` следующего формата
##### `WS` `P` `/notifier/message`
```js
{
    sid: <string>, // Идентификатор сессии вебсокета
    type: <string>, // Тип события
    data: <obj> // Данные события, см. описание конкретного события ниже
}
```
События могут слаться точечно залогиненному пользователю(во все открытые сессии), конкретному соединению по `sid`, сессиям в конкретном канале чата или всем подсоединённым сессиям.  
Формат поля `data` произвольный и зависит от конкретного события. Далее для событий указаны тип и содержимое поля `data`.


Типы уведомлений
----------------


#### Бан в чате
##### `chatBan`
```js
{
    // Данные бана, ответ /api/moderation/check 
}
```
*[/api/moderation/check](admin.md#Проверить-забанен-ли-пользователь)*  
*Приходит при получении бана в чате.*


#### Отметка о нарушении в чате
##### `chatBanAttempt`
```js
{
    messageId: <int>, // Идентификатор сообщения
    channel: <string> // Идентификатор канала
}
```
*Приходит когда кто-то проголосовал за бан этого сообщения.*


#### Отмена бана в чате
##### `chatBanUndo`
```js
{}
```
*Приходит при отмене бана текущего пользователя.*


#### Изменение донат уровня канала чата
##### `chatChannelDonateLevel`
```js
{
    channel: <string>, // Идентификатор канала
    level: <int>, // Новый уровень
    amount: <int>, // Полная сумма доната
    topDonator: <string> // Имя топ донатера(который внёс >= 90% суммы текущего доната за рассматриваемый период)
}
```
*Приходит при изменении уровня по суммарному донату(без прямых переводов и антидоната) за некоторый период(например 1 уровень - 300 пекоинов, 2 - 600 и т.д.). Только для каналов чата стримов. Используется для выдачи пользователям в этом канале бонусов(например смайлы соответствующего уровня).*


#### Ошибка отправки сообщения в чат сервис
##### `chatThirdpartySendMessageError`
```js
{
    message: <string>, // Текст ошибки
}
```
*Приходит при ошибке отправки сообщения в сторонние сервисы: twitch, goodgame.*


#### Логин через сторонние сервисы
##### `thirdpartyLogin`
```js
{
    // Данные логина, ответ /api/user/current 
}
```
*[`/api/user/current`](common.md#Данные-текущего-пользователя)*  
*Приходит при успешной авторизации через сторонний сервис.*


#### Регистрация через сторонние сервисы
##### `thirdpartyRegister`
```js
{
    name: <string>, // Предлагаемое имя пользователя на основе данных стороннего сервиса
    token: <string> // Токен для завершения регистрации
}
```
*Приходит при успешной авторизации через сторонний сервис если нет пользователя к которому привязан этот сервис.*