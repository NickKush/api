Общий API
==========
  1. [**Общие положения**](#Общие-положения)
  2. [**Пользователь**](#Пользователь)
    - [`POST` `P` `/api/user` Найти пользователя](#Найти-пользователя)
    - [`POST` `P` `/api/user/current` Данные текущего пользователя](#Данные-текущего-пользователя)
    - [`POST` `P` `/api/user/login` Логин](#Логин)
    - [`POST` `P` `/api/user/logout` Логаут](#Логаут)
    - [`POST` `C` `/api/user/register` Регистрация](#Регистрация)
    - [`POST` `A` `/api/user/settings` Получить или установить настройки текущего пользователя](#Получить-или-установить-настройки-текущего-пользователя)
  3. [**Категория**](#Категория)
    - [`POST` `P` `/api/category` Категория контента](#Категория-контента)
  5. [**Стрим**](#Стрим)
    - [`POST` `P` `/api/stream` Данные стрима](#Данные-стрима)
  6. [**Чат**](#Чат)
    - [`POST` `P` `/api/channel/data` Данные-стрима каналов](#Данные-стрима-каналов)
    - [`POST` `P` `/api/smile` Доступные смайлы канала](#Доступные-смайлы-канала)
  7. [**Фильтр**](#Фильтр)
    - [`POST` `A/P` `/api/content` Список элементов контента](#Список-элементов-контента)
    - [`POST` `P` `/api/content/top` Топ N элементов контента](#Топ-N-элементов-контента)
  8. [**Подписки**](#Подписки)
    - [`POST` `A` `/api/subscribe/add` Подписаться](#Подписаться)
    - [`POST` `A` `/api/subscribe/amount` Колличество подписок онлайн](#Колличество-подписок-онлайн)
    - [`POST` `A` `/api/subscribe/check` Проверить подписку](#Проверить-подписку)
    - [`POST` `A` `/api/subscribe/list` Получить список подписок](#Получить-список-подписок)
    - [`POST` `A` `/api/subscribe/remove` Отписаться](#Отписатся)
    - [`POST` `A` `/api/subscribe/subscribers` Список подписчиков пользователя](#Список-подписчиков-пользователя)
  9. [**Игноры**](#Игноры)
    - [`POST` `A` `/api/ignore/add` Добавить в список игнорируемых](#Добавить-в-список-игнорируемых)
    - [`POST` `A` `/api/ignore/check` Проверить на игнор](#Проверить-на-игнор)
    - [`POST` `A` `/api/ignore/list` Список игнорируемого](#Список-игнорируемого)
    - [`POST` `A` `/api/ignore/remove` Удалить из списка игнорируемого](#Удалить-из-списка-игнорируемого)
  10. [**Дополнительные вызовы**](#Дополнительные-вызовы)
    - [`POST` `P` `/api/support?name=<streamer_name>` Получить список последних поддержавших для данного стримера за 5 минут](#Получить-список-последних-поддержавших-для-данного-стримера-за-5-минут)

## Общие положения

Запрос посылается методом `POST`, если не указано другое, параметры запроса в JSON формате.
Авторизация происходит через токен в `header`. Например,

```
POST /user/current HTTP/1.1
Token: Bearer <your token here>
```

Успешный ответ приходит со статусом `200`.
При ошибке ответ приходит со статусом `500,` формат ошибки
```js
{
    message: <string> // error message
}
```

Параметры, значение которых должно быть установлено в `null`, могут не передаваться.

Версия API передается через `accept`. Например,
```
GET /user/current HTTP/1.1
Accept: application/json; version=1.0
```
*В данный момент передавать версию не обязательно*

Запросы передаются на сайт [`funstream.tv`](http://funstream.tv) для общего API и на [http://funstream.tv:3811](http://funstream.tv:3811) для чата.

Примеры запросов на [`curl`](http://funstream.tv:3811)
```sh
curl -H "Content-Type: application/json" -H "Accept: application/json; version 1.0" -X POST -d '{name: "..", password: ".."}' http://funstream.tv/api/user/login
curl -H "Content-Type: application/json" -H "Accept: application/json; version 1.0" -H "Token: Bearer .." -X POST -d '{content: "stream"}' http://funstream.tv/api/subscribe/subscribers
```

## Пользователь

#### Найти пользователя
#####[`POST` `P` `/api/user`](http://funstream.tv/api/user)
**запрос** *(можно передать как отдельно id или name, так и вместе)*
```js
{
    id: <int|null>, // Идентификатор пользователя
    name: <string|null> // Имя пользователя
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор пользователя
    name: <string> // Имя пользователя
}
```
*возвращает ошибку в случае если пользователь с таким именем или id не найден, либо если и имя и id переданы как `null`*

#### Данные текущего пользователя
#####[`POST` `P` `/api/user/current`](http://funstream.tv/api/user/current)
**запрос** пустой, *под этой фразой в дальнейшем подразумевается запрос вида {}*

**ответ**, *если токена авторизации нету*
```js
{
    guest: true,
    settings: <obj>, // Настройки пользователя по умолчанию, смотри /api/user/settings
    roles: <obj> {
        //...
    } // Роли пользователя по умолчанию
}
```
**ответ**, *если токен авторизации есть*
```js
{
    guest: false,
    id: <int>, // Идентификатор текущего пользователя
    name: <string>, // Имя текущего пользователяr
    settings: <obj>, // настройки пользователя, смотри /api/user/settings
    roles: <obj> {
        support: <bool>, // роль сапортет, false по умолчанию
        canUseSupport: <bool>, // Разрешить задавать вопрос поддержке и присоединятся к каналу поддержки. true по умолчанию
        moderator: <bool>, // разрешить отменять бан, false по умолчанию
        citizen: <int> // Сила голоса общественной модерации, 0 по умолчанию
    } // user roles
}
```
*возвращает ошибку если токен авторизации ошибочный*

#### Логин
#####[`POST` `P` `/api/user/login`](http://funstream.tv/api/user/login)
**запрос**
```js
{
    name: <string>, // Имя пользлователя
    password: <string> // Пароль пользователя
}
```
**ответ**
```js
{
    token: <string>, // Строка с токеном
    current: <obj> {/*...данные для /user/current API запроса...*/}
}
```
*возвращает ошибку если пользователь с таким именем и паролем не найден*

#### Логаут
#####[`POST` `P` `/api/user/logout`](http://funstream.tv/api/user/logout)
**запрос пустой, ответ пустой**
*уничтожает куку, установленную при логине*

#### Регистрация
#####[`POST` `C` `/api/user/register`](http://funstream.tv/api/user/register)
**запрос**
```js
{
    name: <string>, // Имя пользователя
    password: <string>, // Пароль пользователя
    email: <string>, // Почта пользователя
    recaptchaResponse: <string> // строка ответа для Рекапчи
}
```
**ответ**
```js
{
    token: <string>, // строка с токеном
    current: <obj> {/*...данные из /user/current API запроса...*/}
}
```
*возвращает ошибку если пользователь с таким именем уже существует, либо если не была пройдена капча*

#### Получить или установить настройки текущего пользователя
#####[`POST` `A` `/api/user/settings`](http://funstream.tv/api/user/settings)
**запрос и ответ идентичны**
```js
{

    stream: <obj> {
        autostart: <bool>, // запустить плеер автоматически, true по умолчанию,
        player: <string>, // предпочитаемый плеер, не установлен по умолчанию,
        skipmain: <bool> // пропустить список стримов, false по умолчанию,
    },
    chat: <obj> {
        smiles: <bool>, // показывать смайлы, true по умолчанию"
        images: <bool>, // показывать миниатюру картинок в чате, false по умолчанию
        fontsize: <int>, // размер шрифта чата, 12  по умолчанию
        namecolor: <int>, // цвет ника, 0  по умолчанию
        mychannels: <array of strings>, // список названий закрепленных каналов пользователя, пустой массив по умолчанию
        theme: <string>, // оформление чата, 'default' по умолчанию
        disablenamecolor: <bool>, // разрешить только цвета ников в чате по умолчанию, false по умолчанию
        thirdparty: <bool> // показывать сообщения Твича и Гудгейма, true по умолчанию
    }
}
```
*вернет ошибку если токена авторизации нету или он ошибочен, или если указаны ошибочные настройки*
*в запросе могут отсутствовать все поля, или их часть*
*если в запросе присутствуют поля - их значения будут сохранены для текущего пользователя*

## Категория

#### Категория контента
#####[`POST` `P` `/api/category`](http://funstream.tv/api/category)
**запрос**
```js
{
    content: <string>, // Тип категории, сейчас только 'stream'
    id: <int|null>, // Идентификатор категории
    slug: <string|null>, // Короткое имя категории
    options: <object|null> {
        subCategories: <bool|null>, // Включая подкатегории если true
        contentAmount: <bool|null> // Включая количество контента если true
    }
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор категории
    slug: <string>, // Короткое имя категории
    name: <string>, // имя категории
    subCategories: <array|null> {/*... те же данные что и в /stream/category API запросе...*/},
    contentAmount: <int|null> // количество контента
}
```
*`subCategories=true` возвращает только один уровень подкатегорий, рекурсии нет*
*вернет ошибку если категория с таким `id` или `slug` не найдена, самая верхняя категория ищется по `slug`,*
*с именем "top", если `id` и `slug` установлены в `null` одновременно, вернет ошибку.*

## Стрим

#### Данные стрима
#####[`POST` `P` `/api/stream`](http://funstream.tv/api/stream)
**запрос**
```js
{
    id: <int|null>, // Идентификатор стрима
    streamer: <string|null>, // Логие пользователя
    options: <obj|null> {
        players: <bool|null> // включить плееры для текущего стрима если true
    }
}
```
**ответ**
```js
{
    streamer: <obj> {/*... те же данные что и в /user api request...*/},
    name: <string>, // имя стрима
    description: <string>, // описание стрима
    category: <obj> {/*...те же данные что и в  /stream/category API запросе, без опций...*/},
    image: <string>, // URL превью
    thumbnail: <string>, // URL изображения миниатюры плеера
    adult: <bool>, // флаг 'для взрослых'
    rating: <int>, // текущий рейтинг стрима
    players: <array|null> [
        /*...*/,
        {
            name: <string>, // Имя плеера
            channel: <string>, // имя канала для этого плеера
            code: <string> // html код плеера
        },
        /*...*/,
    ]
}
```
*вернет ошибку если стрима с данным id не существует, либо не указаны ни id ни streamer.*

## Чат

#### Данные каналов:
#####[`POST` `P` `/api/channel/data`](http://funstream.tv/api/channel/data)
**запрос**
```js
{
    channels: <array> [
        <string> // Уникальный идентификатор канала, для стрима это 'stream/<streamer id>'
        //...
    ]
}
```
**ответ**
```js
[
    {
        id: <string>, // Уникальный идентификатор канала
        name: <string>, //Имя канала"
        user: <obj|null> {id: <int>, name: <string>} // объект пользователя
 }
]
```
*если в запросе пустой массив, запрос пустой или если среди запрошенных каналов есть хотя бы один*
*некорректный - вернет ошибку*
*если token отсутствует или неверный - вернет ошибку*

#### Доступные смайлы канала:
#####[`POST` `P` `/api/smile`](http://funstream.tv/api/smile)
**запрос**
````js
{
    channel: <string> // Канал чата, для стрима это 'stream/<streamer id>'
}
```
**ответ**
```js
[
    /*...*/,
    [
        /*...*/,
        {
            code: <string>, // код смайла
            image: <string>, // имя файла со смайлом
            position: <int>, // Место расположения смайла
            usable: <bool>, // Пользователь может использовать этот смайл
            width: <int>, // Ширина смалйа
            height: <int> // Высота смайла
        },
        /*...*/
    ],
    /*...*/
]
```

## Фильтр

#### Список элементов контента:
#####[`POST` `A/P` `/api/content`](http://funstream.tv/api/content)
**запрос**
```js
{
    content: <string>, // Тип контента. Сейчас только 'stream'
    type: <string>, // Тип фильтра, может быть: 'all, 'my'
    category: <obj|null> {
        id: <int|null>, // Идентификатор категории
        slug: <string|null> // Короткое имя категории
    },
    options: <obj|null> {
        save: <bool|null> // Сохранить текущий тип и категорию для этого типа контента для опций если true
    }
}
```
**ответ**
```js
{
    category: <obj> {
        parent: <obj|null> {/*...  те же самые данные что и в  /stream/category API запросе, без опций...*/},
        current: <obj> {/*... те же самые данные что и в /stream/category API запросе, с contentAmount=true, subCategories=true...*/},
    },
    content: <array> [
        /*...*/,
        <content obj>
        /*...*/,
    ],
    subscribed: <null|int> // Количество элментов для этой категории в подписках, null если не авторизирован
}
```
*для стримов аналогичен ответу `/api/stream`, `players=false`*
*вернет ошибку если указан ошибочный тип контента, ошибочный тип фильтра или несуществующая категория*
*вернет ошибку если установлена опция `save=true`, и при этом токен авторизации не передан или ошибочный*
*вернет ошибку, если `type=my`, и при этом токен авторизации не передан или ошибочный*

#### Топ N элементов контента:
#####[`POST` `P` `/api/content/top`](http://funstream.tv/api/content/top)
**запрос**
```js
{
    content: <string>, // Тип контента. Сейчас только 'stream'
    category: <obj|null> {
        id: <int|null>, // Идентификатор категории
        slug: <string|null> // Короткое имя категории
    },
    amount: <int> // Количество элементов сверху
}
```
**ответ**
```js
{
    content: <array> [
        /*...*/,
        <content obj>
        /*...*/,
    ]
}
```
*вернет amount элементов с наивысшим рейтингом, сортировка по рейтингу*
*вернет ошибку если `amount > 10`*
*для стримов аналогичен ответу `/api/stream`, `players=true`*
*вернет ошибку если указан ошибочный тип контента, ошибочный тип фильтра или несуществующая категория*

## Подписки

#### Подписаться:
#####[`POST` `A` `/api/subscribe/add`](http://funstream.tv/api/subscribe/add)
**запрос**
```js
{
    content: <string>, // Тип контента. Сейчас только 'stream'
    id: <int> // Идентификатор элемента контента
}
```
*Ответ пустой. Вернет ошибку если неверно указан контент, `id` не существует, не авторизован или неверный `token`.*

#### Колличество подписок онлайн:
#####[`POST` `A` `/api/subscribe/amount`](http://funstream.tv/api/subscribe/amount)
*Считает количество активных элементов в подписках у пользователя.*
**запрос**
```js
{
    content: <string>, // Содержимое запроса, сейчас только 'stream'
}
```
**ответ**
```js
{
    amount: <int>, // Количество активных подписчиков на данный контент
}
```

#### Проверить подписку:
#####[`POST` `A` `/api/subscribe/check`](http://funstream.tv/api/subscribe/check)
**запрос**
```js
{
    content: <string>, // Тип контента. Сейчас только 'stream'
    id: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
{
    result: <bool> // true в случае успеха
}
```
*Вернет ошибку если неверно указан контент, `id` не существует, не авторизован или неверный `token`.*


#### Получить список подписок:
#####[`POST` `A` `/api/subscribe/list`](http://funstream.tv/api/subscribe/list)
**запрос**
```js
{
    content: <string> // Тип контента. Сейчас только 'stream'
}
```
**ответ**
```js
[
    <obj>, // объект указанного контента. Сейчас только /api/stream
    /*...*/,
    <obj>
]
```
*Вернет ошибку если пользователь не авторизован, либо передан неверный контент.*

#### Отписаться:
#####[`POST` `A` `/api/subscribe/remove`](http://funstream.tv/api/subscribe/remove)
**запрос**
```js
{
    content: <string>, // Тип контента. Сейчас только 'stream'
    id: <int> // Идентификатор элемента контента
}
```
*Ответ пустой. Вернет ошибку если неверно указан контент, `id` не существует, не авторизован или неверный `token`.*


#### Список подписчиков пользователя:
#####[`POST` `A` `/api/subscribe/subscribers`](http://funstream.tv/api/subscribe/subscribers)
*Если пользователь стример, то вернет всех подписанных на него пользователей.*
**запрос**
```js
{
    content: <string> // тип контента. Сейчас только 'stream'
}
```
**ответ**
```js
[
    <obj>, // то же что и /api/user объект
    /*...*/,
    <obj>
]
```

*Вернет ошибку если пользователь неавторизован, либо не является стримером, либо передан неверный контент.*

## Игноры

#### Добавить в список игнорируемых:
#####[`POST` `A` `/api/ignore/add`](http://funstream.tv/api/ignore/add)
**запрос**
```js
{
    content: <string>, // Содержимое игнора
    item: <int> // идентификатор элемента
}
```
**ответ пустой**, *даст ошибку если пользователь неавторизован*

#### Проверить на игнор:
#####[`POST` `A` `/api/ignore/check`](http://funstream.tv/api/ignore/check)
**запрос**
```js
{
    content: <string>, // Содержимое игнора
    item: <int> // идентификатор элемента
}
```
**ответ**
```js
{
    ignored: <bool> // true если в игноре
}
```
*вернет ошибку если пользователь неавторизован*

#### Список игнорируемого:
#####[`POST` `A` `/api/ignore/list`](http://funstream.tv/api/ignore/list)
**запрос**
```js
{
    content: <string> // Содержимое игнора
}
```
**ответ**
```js
[
    ...,
    {
        content: <string>, // Содержимое игнора
        item: <int> // идентификатор элемента
    },
    ...
]
```
*вернет ошибку если пользователь неавторизован*

#### Удалить из списка игнорируемого:
#####[`POST` `A` `/api/ignore/remove`](http://funstream.tv/api/ignore/remove)
**запрос**
```js
{
    content: <string>, // Содержимое игнора
    item: <int> // идентификатор элемента
}
```
**ответ пустой**, *даст ошибку если пользователь неавторизован*

## Дополнительные вызовы

#### Получить список последних поддержавших для данного стримера за 5 минут:
#####[`POST` `P` `/api/support?name=<streamer_name>`](http://funstream.tv/api/support?name=<streamer_name>)(заменить на json?)
*Получить список последних поддержавших для данного стримера за 5 минут.*

**ответ**
```js
[
    {
        "date": <float>, // Когда поддержал(формат Юникс)
        "support": <string>, // Имя поддержавшего
        "amount": <float>, // Количество
        "msg": <string> // Сообщение
    },
    //...
]
```
