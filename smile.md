API Смайлов
===========
- [**Смайлы**](#Смайлы)
    - [`POST` `P` `/api/smile` Доступные смайлы](#Доступные-смайлы)
    - [`POST` `MS/Sm` `/api/smile/add` Добавить смайл](#Добавить-смайл)
    - [`POST` `Sm` `/api/smile/approve` Утвердить изменения в смайлах стримера](#Утвердить-изменения-в-смайлах-стримера)
    - [`POST` `Sm` `/api/smile/pending` Список изменений в смайлах стримеров на утверждение](#Список-изменений-в-смайлах-стримеров-на-утверждение)
    - [`POST` `Sm` `/api/smile/reject` Отклонить изменения в смайлах стримера](#Отклонить-изменения-в-смайлах-стримера)
    - [`POST` `MS/Sm` `/api/smile/remove` Удалить смайлы](#Удалить-смайлы)
    - [`POST` `MS/Sm` `/api/smile/update` Обновить смайлы](#Обновить-смайлы)
    - [`POST` `MS` `/api/smile/ms/pending` Наличие смайлов в ожидании утверждения](#Наличие-смайлов-в-ожидании-утверждения)
    - [`POST` `MS` `/api/smile/ms/prepare` Отправить текущие изменения в смайлах на утверждение](#Отправить-текущие-изменения-в-смайлах-на-утверждение)
    - [`POST` `MS` `/api/smile/ms/revert` Откатить изменения в смайлах](#Откатить-изменения-в-смайлах)
- [**Иконки**](#Иконки)
    - [`POST` `Ms` `/api/icon/add` Добавление иконки](#Добавление-иконки)
    - [`POST` `P` `/api/icon/list` Список иконок](#Список-иконок)
    - [`POST` `Ms` `/api/icon/remove` Удаление иконок](#Удаление-иконок)


## Смайлы

#### Доступные смайлы
##### [`POST` `P` `/api/smile`](http://funstream.tv/api/smile)
**запрос**
```ts
{}
```
**ответ**
```ts
[
    {
        id: number; // Идентификатор смайла
        code: string; // Код
        url: string; // Полная ссылка на файл картинки
        tab: number; // Номер группы к которой относится смайл
        position: number; // Позицияв в группе (порядок для сортировки)
        width: number; // Ширина картинки в пикселях
        height: number; // Высота картинки в пикселях
        user: Object | null; // Стример к которому относится смайл, null для общедоступного смайла, объект из ответа /api/user
        icon: boolean; // false для смайлов, true для иконок, см /api/icon/list
        animated: boolean; // Флаг анимированного смайла
    },
    ...
]
```
*[`/api/user`](common.md#Данные-пользователя), [`/api/icon/list`](common.md#Список-иконок)*  
*Иконки стримеров в данный момент хранятся и выводятся так же как смайлы.*  
*Все смайлы, кроме относящихся к стримерам, разбиты по группам с указанной позицией внутри группы.
Для стримерских смайлов `tab` может быть произвольный, указаны данные стримера в `user`.*  
*`position` следует воспринимать как значение для сортировки по нему, может совпадать для смайлов в одной группе.
Для смайлов стримеров позиция указана в рамках смайлов конкретного стримера.*


#### Добавить смайл
##### [`POST` `MS/Sm` `/api/smile/add`](http://funstream.tv/api/smile/add)
**запрос**
```ts
{}
```
**ответ**
```ts
{}
```
*Принимает одиночный файл, Content-Type: multipart/form-data. Кодом смайла считается его имя без расширения.*  
*Для стримера сохраняет смайл в список изменений без аппрува,
для смайлера сразу добавляет смайл в общедоступные в 0 группу с 0 позицией.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или `masterstreamer`,
количество файлов не 1, формат изображения не PNG, размеры изображения не 30х30px или 45х30px,
смайл с таким кодом уже существует или стримера имеет изменения в ожидании утверждения.*


#### Утвердить изменения в смайлах стримера
##### [`POST` `P` `/api/smile/approve`](http://funstream.tv/api/smile/approve)
**запрос**
```ts
{
    userId: number; // Идентификатор стримера
}
```
**ответ**
```ts
{}
```
*Утверждает предложенные стримером изменения в его смайлах, перенося их в список доступных.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или указанный стример не подавал заявку на аппрув.*


#### Список изменений в смайлах стримеров на утверждение
##### [`POST` `Sm` `/api/smile/pending`](http://funstream.tv/api/smile/pending)
**запрос**
```ts
{}
```
**ответ**
```ts
[
    Object, //  Данные смайла, объект из ответа /api/smile
    ...
]
```
*[`/api/smile`](#Доступные-смайлы)*  
*Возвращает список всех смайлов, ожидающих утверждения. Список никак не отсортирован и не сгруппирован,
разбиение по стримерам осуществляется вручную по значению поля `user` каждого смайла.*


#### Отклонить изменения в смайлах стримера
##### [`POST` `Sm` `/api/smile/reject`](http://funstream.tv/api/smile/reject)
**запрос**
```ts
{
    userId: number; // Идентификатор стримера
}
```
**ответ**
```ts
{}
```
*Отклоняет предложенные стримером изменения в его смайлах.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или указанный стример не подавал заявку на аппрув.*


#### Удалить смайлы
##### [`POST` `MS/Sm` `/api/smile/remove`](http://funstream.tv/api/smile/remove)
**запрос**
```ts
[
    number, // Идентификатор смайла
    ...
]
```
**ответ**
```ts
{}
```
*Для пользователя с ролью 'smiler' удаляет указанные смайлы из доступных(можно удалить утверждённые смайлы стримеров).
Для стримера добаляет в изменения удаление смайла(окончательное удаление произойдёт при утверждении изменений).*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или `masterstreamer`, или имеет изменения в ожидании утверждения.*


#### Обновить смайлы
##### [`POST` `MS/Sm` `/api/smile/update`](http://funstream.tv/api/smile/update)
**запрос**
```ts
[
    { // Данные смайла
        id: number; // Идентификатор
        tab: number; // Номер группы
        position: number; // Позиция
    },
    ...
]
```
**ответ**
```ts
{}
```
*Обновляет данные переданных смайлов. При обновлении пользователем с ролью `smiler` изменения применяются сразу к доступным смайлам.
При обновлении стримером изменения сохраняются отдельно и будут применены только после аппрува.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или `masterstreamer`,
у любого из смайлов не передано любое из полей, стример пытается обновить данные не своего смайла или имеет изменения в ожидании утверждения.*


#### Наличие смайлов в ожидании утверждения
##### [`POST` `MS` `/api/smile/ms/pending`](http://funstream.tv/api/smile/ms/pending)
**запрос**
```ts
{}
```
**ответ**
```ts
{
    pending: boolean; // Статус наличия смайлов в ожидании утверждения
}
```
*Вернёт ошибку если пользователь не имеет роли `masterstreamer`.*


#### Отправить текущие изменения в смайлах на утверждение
##### [`POST` `MS` `/api/smile/ms/prepare`](http://funstream.tv/api/smile/ms/prepare)
**запрос**
```ts
{}
```
**ответ**
```ts
{}
```
*Вернёт ошибку если пользователь не имеет роли `masterstreamer` или уже имеет изменения в ожидании утверждения.*


#### Откатить изменения в смайлах
##### [`POST` `MS` `/api/smile/ms/revert`](http://funstream.tv/api/smile/ms/revert)
**запрос**
```ts
{}
```
**ответ**
```ts
{}
```
*Откатывает изменения в смайлах стримера к последнему утверждённому состоянию.*  
*Вернёт ошибку если пользователь не имеет роли `masterstreamer` или уже имеет изменения в ожидании утверждения.*


## Иконки

Работа с иконками аналогична смайлам и запросы ниже являются заглушками к соответствующим запросам смайлов.

#### Добавление иконки
##### [`POST` `Ms` `/api/icon/add`](http://funstream.tv/api/icon/add)
**запрос**
```ts
{}
```
**ответ**
```ts
{}
```
*Принимает одиночный файл, Content-Type: multipart/form-data.*  
*Сохраняет смайл в список изменений без аппрува.*  
*Вернёт ошибку если пользователь не имеет роли `masterstreamer`,  количество файлов не 1, формат изображения не PNG, размеры изображения не 14х14px или стример имеет изменения в ожидании утверждения.*


#### Список иконок
##### [`POST` `P` `/api/icon/list`](http://funstream.tv/api/icon/list)
**запрос**
```ts
{}
```
**ответ**
```ts
[
    Object, // Иконка, объект из ответа /api/smile
    ...
]
```
*[`/api/smile`](smile.md#Доступные-смайлы)*  
*Ответ аналогичен ответу /api/smile, значения полей `tab` и `position` не имеют значения(0), значение поля `icon` - true.*


#### Удаление иконок
##### [`POST` `Ms` `/api/icon/remove`](http://funstream.tv/api/icon/remove)
**запрос**
```ts
[
    number, // Идентификатор иконки
    ...
]
```
**ответ**
```ts
{}
```
*Добаляет в изменения удаление смайла(окончательное удаление произойдёт при утверждении изменений).*  
*Вернёт ошибку если пользователь не имеет роли `masterstreamer` или имеет изменения в ожидании утверждения.*
