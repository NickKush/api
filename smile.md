API Смайлов
===========
- [**Смайлы**](#Смайлы)
    - [`POST` `P` `/api/smile` Доступные смайлы](#Доступные-смайлы)
    - [`POST` `MS/Sm` `/api/smile/add` Добавить смайл](#Добавить-смайл)
    - [`POST` `Sm` `/api/smile/approve` Утвердить изменения в смайлах мастерстримера](#Утвердить-изменения-в-смайлах-мастерстримера)
    - [`POST` `Sm` `/api/smile/pending` Список изменений в смайлах мастерстримеров на утверждение](#Список-изменений-в-смайлах-мастерстримеров-на-утверждение)
    - [`POST` `Sm` `/api/smile/reject` Отклонить изменения в смайлах мастерстримера](#Отклонить-изменения-в-смайлах-мастерстримера)
    - [`POST` `MS/Sm` `/api/smile/remove` Удалить смайлы](#Удалить-смайлы)
    - [`POST` `MS/Sm` `/api/smile/update` Обновить смайлы](#Обновить-смайлы)
    - [`POST` `MS` `/api/smile/ms/pending` Наличие смайлов в ожидании утверждения](#Наличие-смайлов-в-ожидании-утверждения)
    - [`POST` `MS` `/api/smile/ms/prepare` Отправить текущие изменения в смайлах на утверждение](#Отправить-текущие-изменения-в-смайлах-на-утверждение)
    - [`POST` `MS` `/api/smile/ms/prepare` Откатить изменения в смайлах](#Откатить-изменения-в-смайлах)
- [**Иконки**](#Иконки)
    - [`POST` `Ms` `/api/icon/add` Добавление иконки](#Добавление-иконки)
    - [`POST` `P` `/api/icon/list` Список иконок](#Список-иконок)
    - [`POST` `Ms` `/api/icon/remove` Удаление иконок](#Удаление-иконок)


## Смайлы

#### Доступные смайлы
##### [`POST` `P` `/api/smile`](https://funstream.tv/api/smile)
**запрос**
```js
{}
```
**ответ**
```js
[
    {
        id: <int>, // Идентификатор смайла
        code: <string>, // Код
        url: <string>, // Полная ссылка на файл картинки
        tab: <int>, // Номер группы к которой относится смайл
        position: <int>, // Позиция(порядок для сортировки)
        width: <int>, // Ширина картинки в пикселях
        height: <int>, // Высота картинки в пикселях
        level: <int>, // Требуемый уровень пользователя для мс смайлов, 0 для остальных, DEPRECATED(см changelog)
        masterStreamerLevel: <int>, // Уровень смайла мастерстримера, 0 для общедоступного смайла
        siteLevel: <int>, // Уровень общедоступного смайла, 0 для смайла мс
        user: <obj|null>, // Мастерстример к которому относится смайл, null для общедоступного смайла, объект из ответа /api/user
        icon: <bool> // false для смайлов, true для иконок, см /api/icon/list
    },
    ...
]
```
*[`/api/user`](common.md#Данные-пользователя), [`/api/icon/list`](common.md#Список-иконок)*  
*Иконки мастерстримеров в данный момент хранятся и выводятся так же как смайлы.*  
*Все смайлы, кроме относящихся к мастерстримерам, разбиты по группам с указанной позицией внутри группы. Для смайлов мастерстримеров `tab` может быть произвольный, указаны `masterStreamerLevel` и данные мастерстримера в `user`.*  
*`position` следует воспринимать как значение для сортировки по нему, может совпадать для смайлов в одной группе. Для смайлов мастерстримеров позиция указана в рамках смайлов конкретного мастерстримера.*


#### Добавить смайл
##### [`POST` `MS/Sm` `/api/smile/add`](https://funstream.tv/api/smile/add)
**запрос**
```js
{}
```
**ответ**
```js
{}
```
*Принимает одиночный файл, Content-Type: multipart/form-data. Кодом смайла считается его имя без расширения.*  
*Для мастерстримера сохраняет смайл в список изменений без аппрува, для смайлера сразу добавляет смайл в общедоступные в 0 группу с 0 позицией.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или `masterstreamer`,  количество файлов не 1, формат изображения не PNG, размеры изображения не 30х30px, смайл с таким кодом уже существует или мастерстример имеет изменения в ожидании утверждения.*


#### Утвердить изменения в смайлах мастерстримера
##### [`POST` `P` `/api/smile/approve`](https://funstream.tv/api/smile/approve)
**запрос**
```js
{
    userId: <int> // Идентификатор мастерстримера
}
```
**ответ**
```js
{}
```
*Утверждает предложенные мастерстримером изменения в его смайлах, перенося их в список доступных.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или указанный мастерстример не подавал заявку на аппрув.*


#### Список изменений в смайлах мастерстримеров на утверждение
##### [`POST` `Sm` `/api/smile/pending`](https://funstream.tv/api/smile/pending)
**запрос**
```js
{}
```
**ответ**
```js
[
    <obj>, //  Данные смайла, объект из ответа /api/smile
    ...
]
```
*[`/api/smile`](#Доступные-смайлы)*  
*Возвращает список всех смайлов, ожидающих утверждения. Список никак не отсортирован и не сгруппирован, разбиение по стримерам осуществляется вручную по значению поля `user` каждого смайла.*  


#### Отклонить изменения в смайлах мастерстримера
##### [`POST` `Sm` `/api/smile/reject`](https://funstream.tv/api/smile/reject)
**запрос**
```js
{
    userId: <int> // Идентификатор мастерстримера
}
```
**ответ**
```js
{}
```
*Отклоняет предложенные мастерстримером изменения в его смайлах.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или указанный мастерстример не подавал заявку на аппрув.*


#### Удалить смайлы
##### [`POST` `MS/Sm` `/api/smile/remove`](https://funstream.tv/api/smile/remove)
**запрос**
```js
[
    <int>, // Идентификатор смайла
    ...
]
```
**ответ**
```js
{}
```
*Для пользователя с ролью 'smiler' удаляет указанные смайлы из доступных(можно удалить утверждённые смайлы мастерстимеров). Для мастерстримера добаляет в изменения удаление смайла(окончательное удаление произойдёт при утверждении изменений).*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или `masterstreamer`, или имеет изменения в ожидании утверждения.*


#### Обновить смайлы
##### [`POST` `MS/Sm` `/api/smile/update`](https://funstream.tv/api/smile/update)
**запрос**
```js
[
    <obj> { // Данные смайла
        id: <int>, // Идентификатор
        tab: <int>, // Номер группы
        position: <int>, // Позиция
        level: <int> // Уровень
    },
    ...
]
```
**ответ**
```js
{}
```
*Обновляет данные переданных смайлов. При обновлении пользователем с ролью `smiler` изменения применяются сразу к доступным смайлам. При обновлении мастерстримером изменения сохраняются отдельно и будут применены только после аппрува.*  
*Вернёт ошибку если пользователь не имеет роли `smiler` или `masterstreamer`, у любого из смайлов не передано любое из полей, мастерстример пытается обновить данные не своего смайла или имеет изменения в ожидании утверждения.*


#### Наличие смайлов в ожидании утверждения
##### [`POST` `MS` `/api/smile/ms/pending`](https://funstream.tv/api/smile/ms/pending)
**запрос**
```js
{}
```
**ответ**
```js
{
    pending: <bool> // Статус наличия смайлов в ожидании утверждения
}
```
*Вернёт ошибку если пользователь не имеет роли `masterstreamer`.*


#### Отправить текущие изменения в смайлах на утверждение
##### [`POST` `MS` `/api/smile/ms/prepare`](https://funstream.tv/api/smile/ms/prepare)
**запрос**
```js
{}
```
**ответ**
```js
{}
```
*Вернёт ошибку если пользователь не имеет роли `masterstreamer` или уже имеет изменения в ожидании утверждения.*


#### Откатить изменения в смайлах
##### [`POST` `MS` `/api/smile/ms/revert`](https://funstream.tv/api/smile/ms/revert)
**запрос**
```js
{}
```
**ответ**
```js
{}
```
*Откатывает изменения в смайлах мастерстримера к последнему утверждённому состоянию.*  
*Вернёт ошибку если пользователь не имеет роли `masterstreamer` или уже имеет изменения в ожидании утверждения.*


## Иконки

Работа с иконками аналогична смайлам и запросы ниже являются заглушками к соответствующим запросам смайлов.

#### Добавление иконки
##### [`POST` `Ms` `/api/icon/add`](https://funstream.tv/api/icon/add)
**запрос**
```js
{}
```
**ответ**
```js
{}
```
*Принимает одиночный файл, Content-Type: multipart/form-data.*  
*Сохраняет смайл в список изменений без аппрува.*  
*Вернёт ошибку если пользователь не имеет роли `masterstreamer`,  количество файлов не 1, формат изображения не PNG, размеры изображения не 14х14px или мастерстример имеет изменения в ожидании утверждения.*


#### Список иконок
##### [`POST` `P` `/api/icon/list`](https://funstream.tv/api/icon/list)
**запрос**
```js
{}
```
**ответ**
```js
[
    <obj>, // Объект из ответа /api/smile
    ...
]
```
*[`/api/smile`](smile.md#Доступные-смайлы)*  
*Ответ аналогичен ответу /api/smile, значения полей `tab`, `position` и `level` не имеют значения(0), значение поля `icon` - true.*


#### Удаление иконок
##### [`POST` `Ms` `/api/icon/remove`](https://funstream.tv/api/icon/remove)
**запрос**
```js
[
    <int>, // Идентификатор иконки
    ...
]
```
**ответ**
```js
{}
```
*Добаляет в изменения удаление смайла(окончательное удаление произойдёт при утверждении изменений).*  
*Вернёт ошибку если пользователь не имеет роли `masterstreamer` или имеет изменения в ожидании утверждения.*
